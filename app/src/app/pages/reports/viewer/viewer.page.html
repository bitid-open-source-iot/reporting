<mat-toolbar color="primary">
    <button mat-icon-button class="menu-toggle" (click)="history.back()">
        <mat-icon>
            arrow_back
        </mat-icon>
    </button>

    <div class="page-label spacer">
        {{ loading ? 'report viewer loading' : report.description }}
    </div>

    <button mat-icon-button class="menu-toggle" (click)="download()" disabled *ngIf="report && report.type == 'dashboard'">
        <mat-icon svgIcon="download"></mat-icon>
    </button>
</mat-toolbar>

<mat-progress-bar mode="indeterminate" color="accent" *ngIf="loading"></mat-progress-bar>

<div class="page-body frame" [class.showframe]="report && !loading && report.type == 'ds'">
    <iframe #frame src="" frameborder="0" allowfullscreen [class.showframe]="report && !loading && report.type == 'ds'"></iframe>
</div>

<div id="dashboard" class="page-body" *ngIf="layout && report && !loading && report.type == 'dashboard'" [style.color]="report.theme.color" [style.background]="report.theme.board">
    <div class="filter" [style.color]="report.theme.color" [style.background]="report.theme.column">
        <mat-select class="dashboard-select" [(ngModel)]="period.tense" (ngModelChange)="load()">
            <mat-option value="current">
                CURRENT
            </mat-option>
            <mat-option value="previous">
                PREVIOUS
            </mat-option>
            <mat-option value="custom-dates">
                CUSTOM DATES
            </mat-option>
        </mat-select>

        <mat-select class="dashboard-select" [(ngModel)]="period.frame" (ngModelChange)="load()" *ngIf="period.tense != 'custom-dates'">
            <mat-option value="day">
                DAY
            </mat-option>
            <mat-option value="week">
                WEEK
            </mat-option>
            <mat-option value="month">
                MONTH
            </mat-option>
            <mat-option value="year">
                YEAR
            </mat-option>
        </mat-select>

        <button mat-stroked-button class="dashboard-select" (click)="SelectDates()" *ngIf="period.tense == 'custom-dates'">
            {{ date.from | date : 'yyyy/MM/dd HH:mm' }} - {{ date.to | date : 'yyyy/MM/dd HH:mm' }}
        </button>
    </div>

    <blox>
        <row *ngFor="let row of report.layout[layout].rows" [height]="row.style.height" [background]="row.style.background">
            <column *ngFor="let column of row.columns" [width]="column.style.width" [style.color]="column.style.color" [background]="column.style.background">
                <column-label *ngIf="column.widget" [class.hidden]="!column.widget.label.visable">
                    {{ column.widget.label.value }}
                </column-label>

                <column-content *ngIf="column.widget">
                    <h1 class="value" *ngIf="column.widget && column.widget.data && column.widget.type == 'value'" [style.color]="column.widget.value.color">
                        {{ column.widget.data.type == 'analog' ? (column.widget.data.value | number : '0.2-2') : (column.widget.data.value == 0 ? column.widget.data.digital.low : column.widget.data.digital.high) }}
                        <small *ngIf="column.widget.data.type == 'analog' && column.widget.data.analog.units">
                            {{ column.widget.data.analog.units }}
                        </small>
                    </h1>
                </column-content>
                    
                <chart *ngIf="column.widget && column.widget.data && column.widget.type == 'chart'" [type]="column.widget.chart.type" [data]="column.widget.data.value" [units]="column.widget.data.analog.units" [color]="column.style.color" [format]="date.format" [background]="column.widget.chart.color" [label]="column.widget.label.value"></chart>
            </column>
        </row>
    </blox>
</div>