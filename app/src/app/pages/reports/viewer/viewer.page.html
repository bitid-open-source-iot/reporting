<mat-toolbar color="primary">
    <button mat-icon-button class="menu-toggle" routerLink="/reports">
        <mat-icon>
            arrow_back
        </mat-icon>
    </button>

    <div class="page-label spacer">
        {{ loading ? 'report viewer loading' : report.description }}
    </div>

    <button mat-icon-button matTooltip="Edit Report" [routerLink]="['/reports', 'editor']" [queryParams]="{'mode': 'update','reportId': reportId}" *ngIf="report.role >= 3">
        <mat-icon svgIcon="edit"></mat-icon>
    </button>
</mat-toolbar>

<mat-progress-bar mode="indeterminate" color="accent" *ngIf="loading"></mat-progress-bar>

<div class="page-body frame" [class.showframe]="report && report.type == 'ds'">
    <iframe #frame src="" frameborder="0" allowfullscreen [class.showframe]="report && !loading && report.type == 'ds'"></iframe>
</div>

<div id="dashboard" class="page-body" *ngIf="layout && report && report.type == 'dashboard'" [style.color]="report.theme.font.color" [style.background]="report.theme.board.color">
    <blox>
        <filter [fill]="report.theme.board" [font]="report.theme.font">
            <mat-select class="dashboard-select" [(ngModel)]="period.tense" (ngModelChange)="load()">
                <mat-option value="current">
                    CURRENT
                </mat-option>
                <mat-option value="previous">
                    PREVIOUS
                </mat-option>
                <mat-option value="custom-dates">
                    CUSTOM DATES
                </mat-option>
            </mat-select>
    
            <mat-select class="dashboard-select" [(ngModel)]="period.frame" (ngModelChange)="load()" *ngIf="period.tense != 'custom-dates'">
                <mat-option value="day">
                    DAY
                </mat-option>
                <mat-option value="week">
                    WEEK
                </mat-option>
                <mat-option value="month">
                    MONTH
                </mat-option>
                <mat-option value="year">
                    YEAR
                </mat-option>
            </mat-select>
    
            <button mat-stroked-button class="dashboard-select" (click)="SelectDates()" *ngIf="period.tense == 'custom-dates'">
                {{ date.from | date : 'yyyy/MM/dd HH:mm' }} - {{ date.to | date : 'yyyy/MM/dd HH:mm' }}
            </button>
        </filter>

        <row *ngFor="let row of report.layout[layout]" [id]="row.rowId" [height]="row.height" [position]="row.position">
            <column *ngFor="let column of row.columns" [fill]="column.fill" [font]="column.font" [width]="column.width" [stroke]="column.stroke" [position]="column.position">
                <banner [font]="column.banner">
                    {{ column.label }}
                </banner>

                <text *ngIf="!column.error && !column.loading && column.display == 'text'" [font]="column.font" [style.top.px]="column.banner.size + 10" [style.left.px]="column.banner.size" [style.right.px]="column.banner.size" [style.bottom.px]="column.banner.size">
                    {{ column.text.value }}
                </text>

                <value *ngIf="!column.error && !column.loading && column.data && column.display == 'value'" [font]="column.font">
                    {{ column.data.type == 'analog' ? (column.data.value | number : '0.2-2') : (column.data.value == 0 ? column.data.digital.low : column.data.digital.high) }}{{ (column.data.type == 'analog' && column.data.analog.units) ? column.data.analog.units : '' }}
                </value>

                <image *ngIf="!column.error && !column.loading && column.display == 'image'" [src]="column.image.src"></image>

                <chart *ngIf="!column.error && !column.loading && column.data && column.display == 'chart'" [type]="column.chart.type" [data]="column.data.value" [units]="column.data.analog.units" [font]="column.font" [label]="column.label" [format]="date.format" [chartfill]="column.chartfill" [gridlines]="column.gridlines"></chart>
                
                <error *ngIf="column.error && !column.loading" [font]="column.font">
                    Issue loading data!
                </error>

                <mat-spinner *ngIf="column.loading" diameter="30"></mat-spinner>
            </column>
        </row>
    </blox>
</div>