<mat-toolbar color="primary">
    <button mat-icon-button class="menu-toggle" routerLink="/reports">
        <mat-icon>
            arrow_back
        </mat-icon>
    </button>

    <div class="page-label spacer" *ngIf="report.type == 'ds'">
        data studio editor
    </div>

    <div class="spacer" *ngIf="report.type == 'dashboard'">
        <input matInput type="text" [(ngModel)]="report.description" (blur)="save({'description': report.description})" required *ngIf="!loading">
    </div>

    <button mat-icon-button matTooltip="Mobile View" [class.selected]="layout == 'mobile'" (click)="layout = 'mobile'" *ngIf="report.type == 'dashboard'">
        <mat-icon svgIcon="mobile"></mat-icon>
    </button>

    <button mat-icon-button matTooltip="Tablet View" [class.selected]="layout == 'tablet'" (click)="layout = 'tablet'" *ngIf="report.type == 'dashboard'">
        <mat-icon svgIcon="tablet"></mat-icon>
    </button>

    <button mat-icon-button matTooltip="Desktop View" [class.selected]="layout == 'desktop'" (click)="layout = 'desktop'" *ngIf="report.type == 'dashboard'">
        <mat-icon svgIcon="desktop"></mat-icon>
    </button>

    <div class="dot" *ngIf="report.type == 'dashboard'"></div>

    <button mat-icon-button matTooltip="Board Theme" (click)="theme()" *ngIf="report.type == 'dashboard'">
        <mat-icon svgIcon="theme"></mat-icon>
    </button>

    <div class="dot" *ngIf="report.type == 'dashboard'"></div>

    <button mat-icon-button matTooltip="View Report" [routerLink]="['/reports', 'viewer']" [queryParams]="{'reportId': reportId}" *ngIf="report.type == 'dashboard'">
        <mat-icon svgIcon="view"></mat-icon>
    </button>
</mat-toolbar>

<mat-progress-bar mode="indeterminate" color="accent" *ngIf="loading"></mat-progress-bar>

<div class="page-body" *ngIf="report.type == 'ds'">
    <form [formGroup]="form" (ngSubmit)="!form.invalid && !loading && update()">
        <mat-form-field appearance="outline">
            <mat-label text-uppercase>
                data studio url
            </mat-label>
            
            <input matInput type="url" name="url" placeholder="data studio url" formControlName="url" required>
    
            <mat-error *ngIf="errors.url">
                {{ errors.url }}
            </mat-error>
        </mat-form-field>
    
        <mat-form-field appearance="outline">
            <mat-label text-uppercase>
                description
            </mat-label>
            
            <input matInput type="text" name="description" placeholder="description" formControlName="description" required>
    
            <mat-error *ngIf="errors.description">
                {{ errors.description }}
            </mat-error>
        </mat-form-field>
    
        <button type="submit" mat-flat-button color="primary">
            submit
        </button>
    </form>
</div>

<div class="page-body editor" [style.background]="report.theme.board.color" [class.hide]="report && report.type != 'dashboard'">
    <div class="dashboard">
        <blox class="blox" [class]="layout" [editing]="true" [fill]="report.theme.board" cdkDropList (cdkDropListDropped)="reorder($event)">
            <row *ngFor="let row of report.layout[layout] | orderBy : 'position'" type="dynamic" [id]="row.rowId" [height]="row.height" [position]="row.position" cdkDragBoundary=".blox"  cdkDragLockAxis="y" cdkDrag [cdkDragDisabled]="!editing || resizing">
                <column *ngFor="let column of row.columns | orderBy : 'position'" [id]="column.columnId" [fill]="column.fill" [width]="column.width" [stroke]="column.stroke" [position]="column.position">
                    <banner [font]="column.banner">
                        {{ column.label }}
                    </banner>
    
                    <div class="options" [style.background-color]="report.theme.board.color">
                        <button mat-icon-button matTooltip="Edit Column" [style.color]="report.theme.font.color" (click)="edit(row, column)" [disabled]="loading">
                            <mat-icon svgIcon="edit"></mat-icon>
                        </button>
        
                        <button mat-icon-button matTooltip="Remove Column" color="warn" (click)="remove($event, row, column.columnId)" [disabled]="loading">
                            <mat-icon svgIcon="delete"></mat-icon>
                        </button>
                    </div>
                </column>

                <div class="drag-handle" cdkDragHandle>
                    <mat-icon svgIcon="drag" [style.color]="report.theme.font.color"></mat-icon>
                </div>

                <div class="drag-placeholder" *cdkDragPlaceholder></div>
            </row>
        
            <row type="static" [height]="100">
                <column class="add" [width]="100" [fill]="report.theme.column" matRipple matTooltip="Add Row" (click)="add()">
                    <mat-icon [style.color]="report.theme.font.color">
                        add
                    </mat-icon>
                </column>
            </row>
        </blox>
    </div>
</div>