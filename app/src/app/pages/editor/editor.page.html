<mat-sidenav-container>
    <mat-sidenav-content>
        <mat-toolbar color="primary">
            <button mat-icon-button class="menu-toggle">
                <mat-icon>
                    menu
                </mat-icon>
            </button>

            <div class="page-label spacer">
                dashboard editor
            </div>

            <button mat-icon-button [matMenuTriggerFor]="layoutmenu">
                <mat-icon [svgIcon]="layout"></mat-icon>
            </button>

            <mat-menu #layoutmenu="matMenu">
                <button mat-menu-item (click)="layout = 'mobile'">
                    <mat-icon svgIcon="mobile"></mat-icon>
                    Mobile
                </button>
                <button mat-menu-item (click)="layout = 'tablet'">
                    <mat-icon svgIcon="tablet"></mat-icon>
                    Tablet
                </button>
                <button mat-menu-item (click)="layout = 'desktop'">
                    <mat-icon svgIcon="desktop"></mat-icon>
                    Desktop
                </button>
            </mat-menu>

            <button mat-icon-button>
                <mat-icon>
                    palette
                </mat-icon>
            </button>
        </mat-toolbar>
        
        <mat-content class="dashboard" [style.background]="report.theme.board.color">
            <blox class="blox" [class]="layout" [editing]="true" [fill]="report.theme.board" cdkDropList (cdkDropListDropped)="reorder($event)">
                <row *ngFor="let row of report.layout[layout] | orderBy : 'position'" type="dynamic" [id]="row.rowId" [height]="row.height" [position]="row.position" cdkDragBoundary=".blox"  cdkDragLockAxis="y" cdkDrag [cdkDragDisabled]="!editing || resizing">
                    <div class="drag-handle" cdkDragHandle>
                        <mat-icon svgIcon="drag" [style.color]="report.theme.font.color"></mat-icon>
                    </div>

                    <column *ngFor="let column of row.columns | orderBy : 'position'" [id]="column.columnId" [fill]="column.fill" [width]="column.width" [stroke]="column.stroke" [position]="column.position" (click)="select(row, column)">
                        <banner [font]="column.banner">
                            {{ column.label }}
                        </banner>
        
                        <text *ngIf="!column.error && !column.loading && column.display == 'text'" [font]="column.font" [style.top.px]="column.banner.size + 10" [style.left.px]="column.banner.size" [style.right.px]="column.banner.size" [style.bottom.px]="column.banner.size">
                            {{ column.text.value }}
                        </text>
        
                        <value *ngIf="!column.error && !column.loading && column.data && column.display == 'value'" [font]="column.font">
                            {{ column.data.type == 'analog' ? (column.data.value | number : '0.2-2') : (column.data.value == 0 ? column.data.digital.low : column.data.digital.high) }}{{ (column.data.type == 'analog' && column.data.analog.units) ? column.data.analog.units : '' }}
                        </value>
        
                        <image *ngIf="!column.error && !column.loading && column.display == 'image'" [src]="column.image.src"></image>
        
                        <!-- <chart *ngIf="!column.error && !column.loading && column.data && column.display == 'chart'" [type]="column.chart.type" [data]="column.data.value" [units]="column.data.analog.units" [font]="column.font" [label]="column.label" [format]="date.format" [chartfill]="column.chartfill" [gridlines]="column.gridlines"></chart> -->
                        
                        <error *ngIf="column.error && !column.loading" [font]="column.font">
                            Issue loading data!
                        </error>
        
                        <mat-spinner *ngIf="column.loading" diameter="30"></mat-spinner>
                    </column>
    
                    <div class="drag-placeholder" *cdkDragPlaceholder></div>
                </row>
            
                <row type="static" [height]="100">
                    <column class="add" [width]="100" [fill]="report.theme.column" matRipple matTooltip="Add Row">
                        <mat-icon [style.color]="report.theme.font.color">
                            add
                        </mat-icon>
                    </column>
                </row>
            </blox>
        </mat-content>

        <conditions></conditions>
    </mat-sidenav-content>

    <mat-sidenav mode="side" position="end">
        <mat-toolbar color="primary">
            <div class="page-label spacer">
                column editor
            </div>

            <button mat-icon-button (click)="sidenav.toggle()">
                <mat-icon>
                    arrow_forward
                </mat-icon>
            </button>
        </mat-toolbar>

        <mat-content>
            <mat-tab-group id="side-tabs">
                <mat-tab label="Setup">
                    <form [formGroup]="form">
                        <mat-form-field appearance="outline">
                            <mat-label>
                                Label
                            </mat-label>
                            
                            <input matInput type="text" name="label" placeholder="label" formControlName="label" required>
        
                            <mat-error *ngIf="errors.label">
                                {{ errors.label }}
                            </mat-error>
                        </mat-form-field>
        
                        <mat-form-field appearance="outline">
                            <mat-label>
                                Display Type
                            </mat-label>
                            
                            <mat-select name="display" placeholder="display type" formControlName="display" required>
                                <mat-option *ngFor="let o of displays | orderBy : 'description'" [value]="o.value">
                                    {{ o.description }}
                                </mat-option>
                            </mat-select>
        
                            <mat-error *ngIf="errors.display">
                                {{ errors.display }}
                            </mat-error>
                        </mat-form-field>
        
                        <h2 *ngIf="form.value.display == 'value' || form.value.display == 'gauge' || form.value.display == 'chart' || form.value.display == 'table'">
                            Data Connector
                        </h2>
        
                        <mat-form-field appearance="outline" formGroupName="query" *ngIf="form.value.display == 'value' || form.value.display == 'gauge' || form.value.display == 'chart' || form.value.display == 'table'">
                            <mat-label>
                                Device
                            </mat-label>
        
                            <mat-select name="deviceId" placeholder="device" formControlName="deviceId" required>
                                <mat-option [formGroup]="filter">
                                    <ngx-mat-select-search placeholderLabel="filter devices" noEntriesFoundLabel="no devices found" formControlName="device"></ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let device of devices.data | filterBy : {'description': filter.value.device}" [value]="device.deviceId">
                                    {{ device.description }}
                                </mat-option>
                            </mat-select>
        
                            <mat-error *ngIf="errors.query.deviceId">
                                {{ errors.query.deviceId }}
                            </mat-error>
                        </mat-form-field>
        
                        <mat-form-field appearance="outline" formGroupName="query" *ngIf="form.value.display == 'value' || form.value.display == 'gauge' || form.value.display == 'chart' || form.value.display == 'table'">
                            <mat-label>
                                Input
                            </mat-label>
        
                            <mat-select name="inputId" placeholder="input" formControlName="inputId" required>
                                <mat-option [formGroup]="filter">
                                    <ngx-mat-select-search placeholderLabel="filter inputs" noEntriesFoundLabel="no inputs found" formControlName="input"></ngx-mat-select-search>
                                </mat-option>
                                <mat-option *ngFor="let input of inputs | filterBy : {'description': filter.value.input}" [value]="input.inputId">
                                    {{ input.description }}
                                </mat-option>
                            </mat-select>
        
                            <mat-error *ngIf="errors.query.inputId">
                                {{ errors.query.inputId }}
                            </mat-error>
                        </mat-form-field>
        
                        <h2 *ngIf="form.value.display == 'chart'">
                            chart settings
                        </h2>
        
                        <mat-form-field appearance="outline" formGroupName="chart" *ngIf="form.value.display == 'chart'">
                            <mat-label>
                                Type
                            </mat-label>
                            
                            <mat-select name="type" placeholder="type" formControlName="type" [required]="form.value.display == 'chart'">
                                <mat-option value="bar">
                                    Bar
                                </mat-option>
                                <mat-option value="area">
                                    Area
                                </mat-option>
                                <mat-option value="line">
                                    Line
                                </mat-option>
                            </mat-select>
            
                            <mat-error *ngIf="errors.chart.type">
                                {{ errors.chart.type }}
                            </mat-error>
                        </mat-form-field>
        
                        <h2 *ngIf="form.value.display == 'value'">
                            value settings
                        </h2>
        
                        <mat-form-field appearance="outline" formGroupName="value" *ngIf="form.value.display == 'value'">
                            <mat-label>
                                Expression
                            </mat-label>
                            
                            <mat-select name="expression" placeholder="expression" formControlName="expression" [required]="form.value.display == 'value'">
                                <mat-option value="last-value">
                                    Last Value
                                </mat-option>
                                <mat-option value="first-value">
                                    First Value
                                </mat-option>
                                <mat-option value="predicted-value">
                                    Predicted Value
                                </mat-option>
                            </mat-select>
        
                            <mat-error *ngIf="errors.value.expression">
                                {{ errors.value.expression }}
                            </mat-error>
                        </mat-form-field>
        
                        <h2 *ngIf="form.value.display == 'text'">
                            text settings
                        </h2>
        
                        <mat-form-field appearance="outline" formGroupName="text" *ngIf="form.value.display == 'text'">
                            <mat-label>
                                Value
                            </mat-label>
                            
                            <textarea matInput [matTextareaAutosize]="true" rows="5" name="value" placeholder="value" formControlName="value" [required]="form.value.display == 'text'"></textarea>
        
                            <mat-error *ngIf="errors.text.value">
                                {{ errors.text.value }}
                            </mat-error>
                        </mat-form-field>
        
                        <h2 *ngIf="form.value.display == 'image'">
                            image settings
                        </h2>
        
                        <div *ngIf="form.value.display == 'image'" class="image-upload" [style.background-image]="'url(' + form.value.image.src + ')'" (click)="upload()" matRipple></div>
                    </form>
                </mat-tab>

                <mat-tab label="Style">
                    <configoration></configoration>
                </mat-tab>
            </mat-tab-group>
        </mat-content>
    </mat-sidenav>
</mat-sidenav-container>